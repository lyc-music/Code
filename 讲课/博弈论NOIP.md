---
marp: true
---

# 博弈论基础

**Lynkcat**

---

## 公平组合游戏

游戏有两个人参与，二者轮流做出决策，双方均知道游戏的完整信息；

任意一个游戏者在某一确定状态可以作出的决策集合只与当前的状态有关，而与游戏者无关；

游戏中的同一个状态不可能多次抵达，游戏以玩家无法行动为结束，且游戏一定会在有限步后以非平局结束。

---

公平组合游戏可以抽象成一张有向无环图，每个点是一个状态，每条边是一次决策。

定义 必胜状态 为 先手必胜的状态，必败状态 为 先手必败的状态。

通过推理，我们可以得出下面三条定理：

定理 1：没有后继状态的状态是必败状态。
定理 2：一个状态是必胜状态当且仅当存在至少一个必败状态为它的后继状态。
定理 3：一个状态是必败状态当且仅当它的所有后继状态均为必胜状态。

---

如果博弈图是一个有向无环图，则通过这三个定理，我们可以在绘出博弈图的情况下用 $O(N+M)$ 的时间（其中 $N$ 为状态种数，$M$ 为边数）得出每个状态是必胜状态还是必败状态。

---

## 非有向无环图上的博弈

虽然可能存在平局，但是本质上来说判断条件跟上面也是一样的。

---

## 有向图游戏与 SG 函数

在一个有向无环图中，只有一个起点，上面有一个棋子，两个玩家轮流沿着有向边推动棋子，不能走的玩家判负。

定义 $\operatorname{mex}$ 函数的值为不属于集合 $S$ 中的最小非负整数，即：

$$
\operatorname{mex}(S)=\min\{x\} \quad (x \notin S, x \in N)
$$

例如 $\operatorname{mex}(\{0, 2, 4\})=1$，$\operatorname{mex}(\{1, 2\})=0$。

对于状态 $x$ 和它的所有 $k$ 个后继状态 $y_1, y_2, \ldots, y_k$，定义 $\operatorname{SG}$ 函数：

$$
\operatorname{SG}(x)=\operatorname{mex}\{\operatorname{SG}(y_1), \operatorname{SG}(y_2), \ldots, \operatorname{SG}(y_k)\}
$$

而对于由 $n$ 个有向图游戏组成的组合游戏，设它们的起点分别为 $s_1, s_2, \ldots, s_n$，则有定理：**当且仅当 $\operatorname{SG}(s_1) \oplus \operatorname{SG}(s_2) \oplus \ldots \oplus \operatorname{SG}(s_n) \neq 0$ 时，这个游戏是先手必胜的。同时，这是这一个组合游戏的游戏状态 $x$ 的 SG 值。**

这一定理被称作 **Sprague-Grundy 定理**(Sprague-Grundy Theorem), 简称 SG 定理。

---

### SG 定理的证明

可以使用数学归纳法来证明。

我们假设对于游戏状态 $x'$，其当前节点 $s_1', s_2', \ldots, s_n'$（对于任意 $i$ 有 $s_i' < s_i$），皆满足 SG 定理。

显然当 $\operatorname{SG}(s_1)'=\operatorname{SG}(s_2)'=\ldots \operatorname{SG}(s_n)'=0$ 时，该状态能满足 SG 定理。

那么只需要证明对于游戏状态 $x$，其当前节点 $s_1', s_2', \ldots, s_n'$ 符合 SG 定理，SG 定理便成立。

---

在有向图游戏中，当一方将某一节点 $s_i$ 移动到 $\operatorname{SG}$ 值比它大的节点时，另一方可以移动回和 $\operatorname{SG}$ 值和 $\operatorname{SG}(s_i)$ 一样的节点，所以向 SG 值较大节点移动是无效操作。

当移动到 SG 值较小的节点时，能够到达任何一个游戏状态 $x'$ 使得 $\operatorname{SG}(x')= \operatorname{SG}(s_1') \oplus \operatorname{SG}(s_2') \oplus \ldots \oplus \operatorname{SG}(s_n') < \operatorname{SG}(X)$（注意到前文已经假设 $x'$ 满足 SG 定理），但到达不了 SG 值为 $\operatorname{SG}(s_1) \oplus \operatorname{SG}(s_2) \oplus \ldots \oplus \operatorname{SG}(s_n)$ 的节点。

所以状态 $x$ 符合 SG 定理。

---

## Nim 游戏

Nim 游戏是一个经典的公平组合游戏。

$n$ 堆物品，每堆有 $a_i$ 个，两个玩家轮流取走任意一堆的任意个物品，但不能不取。

取走最后一个物品的人获胜。

---

容易发现 $a_i$ 个石子的 $\operatorname{SG}$ 值为 $a_i$，所以将所有 $a_i$ 异或起来即可。

---

## 反 Nim 游戏

$n$ 堆物品，每堆有 $a_i$ 个，两个玩家轮流取走任意一堆的任意个物品，但不能不取。

取走最后一个物品的人失败。

---

## anti-SG 组合游戏

anti-SG 组合游戏规定，决策集合为空的游戏者赢。

anti-SG 组合游戏的其他规则与 SG 游戏相同。

对于任意一个 anti-SG 游戏，如果我们规定当局面中所有的单一游戏的 SG 值均为 $0$ 时，游戏结束，则先手必胜当且仅当：
游戏的 SG 函数不为 $0$ 且游戏中某个单一游戏的 SG 函数大于 $1$；
游戏的 SG 函数为 0 且游戏中没有单一游戏的 SG 函数大于 $1$。

---

证明：所有的终止局面为先手必胜局。

情况一：局面的 SG 函数为 $0$ 且游戏中某个单一游戏的 SG 函数大于 $1$ ⇒先手必败；

情况二：局面的 SG 函数不为 $0$ 且游戏中没有单一游戏的 SG 函数大于 $1$ ⇒先手必败；

情况三：局面的 SG 函数不为 $0$ 且游戏中某个单一游戏的 SG 函数大于 $1$ ⇒先手必胜；

情况四：局面的 SG 函数为 $0$ 且游戏中没有单一游戏的 SG 函数大于 $1$ ⇒先手必胜。

---

阶梯 nim


有 $n$ 个位置 $1...n$，每个位置上有 $a_i$ 个石子。有两个人轮流操作。操作步骤是：挑选 $1...n$ 中任一一个存在石子的位置 $i$，将至少 $1$ 个石子移动至 $i−1$ 位置（也就是最后所有石子都堆在在 $0$ 这个位置）。谁不能操作谁输。求先手必胜还是必败。

结论是：对奇数堆做nim游戏。

---

# 来点小题。

---

### [AGM 2023 资格赛] 另一个游戏]

Charlie 和 Dan 在 $N$ 堆从左到右从 $1$ 到 $N$ 编号的石子堆上玩游戏。每一堆都有正数个石头。

两人轮流执行操作。Charlie 先手。

每回合，玩家从最左边的非空堆中取出正数个石头，并将它们移到相邻的右边的石头堆中。如果在该玩家的回合中，唯一的非空堆是第 $N$ 堆，该玩家将输掉游戏。

如果双方都以最优策略玩这场游戏，谁会赢得这场游戏?

$2≤N≤10^3$。

---

当然一种做法是直接 dp。

但是实际上可以分类讨论，若 $n=2$ 先手必胜，否则若 $a_1=1$ 那么先手必须转移完一堆，而接下来每次后手都可以只剩下一个让先手转移。所以先手必输，同理，若 $a_1$ 不为 $1$，那么先手可以限制后手，所以先手必胜。


---

### [AGC002E] Candy Piles


桌上有 $n$ 堆糖果，第 $i$ 堆糖果有 $a_i$ 个糖。两人在玩游戏，轮流进行，每次进行下列两个操作中的一个:

1. 将当前最大的那堆糖果全部吃完

2. 将每堆糖果吃掉一个

吃完的人输，假设两人足够聪明，问谁有必胜策略？

输出 `First`（表示先手必胜）或 `Second`（表示后手必胜）

$1\leq n\leq 10^5,a_i\leq 10^9$。

---

先将糖果按照数量降序排序。我们在平面直角坐标系上面用矩形来表示这些糖果堆。每个矩形宽度为 $1$，长度为糖果的数量。图形内部的左下角方格为 $(1,1)$。

考虑相当于每次删掉左边一列或下面一行，那问题就又等价于从原点开始向上或向右走走到边界就算输。

直接暴力做复杂度寄，然后发现除了边界其它部分每条对角线是一样的，证明是因为每个必胜态周围四个格子一定是必败态，既然如此那么 $(x-1,y-1)$ 必然是必胜态。而一个必败态因为周围有一个必胜态，两条对角线是相邻的，所以这条对角线上必然也全是必败。既然如此我们只要判断 $(x,x)$ 这条对角线走到头的那个节点是什么状态即可。走到头的状态要么只能一直往上走要么只能一直往右，判一下两个距离即可。

---

### [AGM 2023 资格赛] 棋子游戏

Alice 和 Bob 在一个 $1\times N$ 的矩阵上玩游戏。

有 $M$ 个棋子放在不同的格子上，棋子具有各种各样的颜色。 

每回合选手可以挑选一个棋子，并将这个棋子与后面的跟他不同颜色的棋子（下一个同色棋子之前的棋子）一起往左移动正数距离，移动过程中不能跨过或者重叠前面的那个格子。Alice 先手，谁不能移谁就输了。

接下来有 $Q$ 次操作，每次操作有以下形式：

1：在 $pos$ 位置上放置一个颜色为 $col$ 的棋子。

2：删除位置 $pos$ 上的棋子。

每次操作后输出当前局面的赢家是谁。

$1\leq N\leq 10^9,1\leq M\leq 10^5,1\leq col\leq 5$。

---

发现每次的形式是阶梯 NIM。那么等价于删点加点维护每个颜色的奇数编号段的长度异或和。

用平衡树或者线段树维护即可。

---

### [CEOI2021] Stones

游戏包含 $N$ 堆石子，其中第 $i$ 堆有 $a_i$ 个石子，玩家轮流移除一堆石子中的若干个，取到最后一个石子的玩家获胜。

但在该游戏中每个玩家从哪堆石子中取石子是由另一名玩家固定的。

具体来说，游戏的回合数从 $1$ 开始每次递增，增量为 $1$，而游戏将会以如下方式进行：

- 在奇数回合，Branko 将指定一个非空石子堆。Ankica 将移除这堆石子至少一个，至多所有石子。
- 在偶数回合，Ankica 将指定一个非空石子堆。Branko 将移除这堆石子至少一个，至多所有石子。

作为专业的游戏玩家，在 Branko 摆完石子后，Ankica 很快意识到这个游戏对她有必胜策略。

如果你是 Ankica，你能否获胜呢？

---

这个博弈比较奇怪。

考虑分析一些特殊情况，比如把一个石子的堆与别的分开来考虑。

如果当前堆只有 $1$ 粒石子，那么取完这粒石子，给对手也指定一堆只有 $1$ 粒石子的情况。

否则如果这是最后一堆大于 $1$ 的堆，那么就取完，否则就留下 $1$ 粒让对手取。

这样，如果对手让我们取大于 $1$ 的堆，我们就将这一堆消耗完，否则就消耗两堆 $1$。相当于把最后一堆大于 $1$ 的堆当作 $1$ 来处理，这样一个回合后，$1$ 的堆奇偶性不变，其余堆只会减少。并且每次对手只能取大小为 $1$ 的堆。这样局面就完全被自己掌控了。

---

博弈题一般来说，要么是 SG 套别的东西，要么是混沌奇怪博弈。碰到后面这种题只能多挖掘性质考虑一些特殊情况。

当然博弈论相关还有很多没讲，限于篇幅以及涉及的知识面这里只讲到这些，NOI 系列赛事范围内应该够用了。